{% extends "terms/base.html" %}

{% block pagination %}

<style>
    #loading {
        transition: opacity 1s ease-out;
        opacity: 1;
    }
</style>

<div id="loading">Loading...</div>

<script>
    class ScrollMorePaginator {
        constructor(perPage) {
            this.perPage = perPage
            this.pageIndex = 0
            this.elements = document.querySelectorAll("pre")
            this.loader = document.querySelector("#loading")
            this.options = {
                root: null,
                rootMargin: "0px",
                threshold: 0.25
            }
            this.loadMore()
            this.watchIntersection()
        }

        onIntersect() {
            this.pageIndex++
            this.loadMore()
        }

        watchIntersection() {
            document.addEventListener("DOMContentLoaded", () => {
                let observer = new IntersectionObserver(this.onIntersect.bind(this),
                    this.options);
                observer.observe(this.loader);
            })
        }

        loadMore() {
            const indexMin = this.pageIndex * this.perPage
            const indexMax = indexMin + this.perPage

            this.elements.forEach((el, i) => {
                const visible = i < indexMax
                el.style.display = visible ? "block" : "none"
            })

            const lastPage = indexMax >= this.elements.length
            this.loader.style.opacity = lastPage ? "0" : "1"
        }
    }

    new ScrollMorePaginator(6);
</script>
{% endblock %}
